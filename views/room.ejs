<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="output.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
      integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/fontawesome.min.css"
      integrity="sha512-M5Kq4YVQrjg5c2wsZSn27Dkfm/2ALfxmun0vUE3mPiJyK53hQBHYCVAtvMYEC7ZXmYLg8DVG4tF8gD27WmDbsg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>Sakk - Játék</title>
  </head>
  <body class="min-h-screen bg-amber-100 flex">
    <div class="w-80 bg-white shadow-lg flex flex-col h-screen">
      <div class="bg-amber-600 text-white p-4">
        <h2 class="text-xl font-bold">Chat</h2>
        <p class="text-sm" id="room-info"></p>
      </div>

      <div
        id="chat-messages"
        class="flex-1 overflow-y-auto p-4 space-y-2 bg-amber-50"
      ></div>

      <div class="p-4 bg-white border-t border-gray-200">
        <div class="flex gap-2">
          <input
            id="chat-input"
            type="text"
            placeholder="Üzenet..."
            class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
          />
          <button
            id="send-btn"
            class="px-4 py-2 bg-amber-600 text-white rounded-lg font-semibold hover:bg-amber-700"
          >
            Küldés
          </button>
        </div>
      </div>
    </div>

    <div class="flex-1 flex items-center justify-center p-12">
      <div class="text-center">
        <h1 class="text-4xl font-bold text-amber-600 mb-4">Sakk Játék</h1>
        <div class="bg-orange-400/20 rounded-lg p-2">
          <div
            id="chess-board"
            class="grid grid-cols-8 gap-0 w-[64vh] h-[64vh] border-amber-800"
          ></div>
        </div>
        <button
          id="leave-game-btn"
          class="mt-6 px-6 py-3 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600"
        >
          Kilépés
        </button>
      </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/kliens.js"></script>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const username = urlParams.get("username");
      const roomName = urlParams.get("room");

      if (!username || !roomName) {
        window.location.href = "/";
      }

      const gameClient = new ChessGameClient();
      gameClient.init(username, roomName);

      document.getElementById("send-btn").addEventListener("click", () => {
        const input = document.getElementById("chat-input");
        const message = input.value.trim();

        if (message) {
          gameClient.sendMessage(message);
          input.value = "";
        }
      });

      document
        .getElementById("chat-input")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            document.getElementById("send-btn").click();
          }
        });

      document
        .getElementById("leave-game-btn")
        .addEventListener("click", () => {
          if (
            confirm(
              "Biztosan ki szeretnél lépni? Ez azt jelenti, hogy vesztettél!"
            )
          ) {
            gameClient.leaveRoom();
            window.location.href = "/";
          }
        });

      for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
          const square = document.createElement("div");
          square.className =
            (row + col) % 2 === 0 ? "bg-amber-200" : "bg-amber-800";
          square.style.width = "70px";
          square.style.height = "70px";
          document.getElementById("chess-board").appendChild(square);
        }
      }
    </script>
  </body>
</html>
